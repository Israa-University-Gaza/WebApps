@model IsraaSystem.Core.Classic.HumanResource.EmpEmploymentType.EmpEmploymentType

@{
  Layout = null;
}

<div id="add-emp-employment-type" class="modal-content">
  @if (TempData["add-msg"] != null)
  {
    int status = Convert.ToInt32(TempData["add-msg"].ToString().Split(';')[0]);
    String msg = TempData["add-msg"].ToString().Split(';')[1];
    <script type="text/javascript">
      showToast("@msg", "@((status > 0) ? "success":"error")");
    </script>
    if (status > 0)
    {
      <script type="text/javascript">
        $('.modal').modal('hide');
        $('#form-emp-employment-type').submit();
      </script>
    }
  }
  @{
    AjaxOptions opt = new AjaxOptions
    {
      InsertionMode = InsertionMode.ReplaceWith,
      HttpMethod = "POST",
      UpdateTargetId = "add-emp-employment-type"
    };
  }
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">إضافة نوع توظيف جديد</h4>
  </div>
  <div class="modal-body modal-form">
    <div class="portlet-body form">
      @using (Ajax.BeginForm("Add", "EmpEmploymentType", opt, new { @class = "form-horizontal" }))
      {
        @Html.AntiForgeryToken()
        <div class="form-body">
          <div class="form-group">
            <label class="col-md-2 control-label">الموظف</label>
            <div class="col-md-8">
              @Html.DropDownListFor(model => model.EmployeeID, new SelectList(Model.Employees, "Value", "Text"), "إختر الموظف", new { @class = "form-control select2" })
              @Html.ValidationMessageFor(model => model.EmployeeID, "", new { @class = "text-danger help-block" })
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-2 control-label">نوع التوظيف</label>
            <div class="col-md-3">
              @Html.DropDownListFor(model => model.EmploymentTypeID, new SelectList(Model.EmploymentTypes, "Value", "Text"), "إختر نوع التوظيف", new { @class = "form-control" })
              @Html.ValidationMessageFor(model => model.EmploymentTypeID, "", new { @class = "text-danger help-block" })
            </div>
            <label class="col-md-2 control-label">رقم الموظف</label>
            <div class="col-md-3">
              @Html.TextBoxFor(model => model.EmployeeNo, new { @class = "form-control text-center", placeholder = "رقم الموظف" })
              @Html.ValidationMessageFor(model => model.EmployeeNo, "", new { @class = "text-danger help-block" })
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-2 control-label">من</label>
            <div class="col-md-3">
              @Html.TextBoxFor(model => model.DateFrom, new { @class = "form-control text-center date-picker", placeholder = "yyyy/mm/dd" })
              @Html.ValidationMessageFor(model => model.DateFrom, "", new { @class = "text-danger help-block" })
            </div>
            <label class="col-md-2 control-label">إلى</label>
            <div class="col-md-3">
              @Html.TextBoxFor(model => model.DateTo, new { @class = "form-control text-center date-picker", placeholder = "yyyy/mm/dd" })
              @Html.ValidationMessageFor(model => model.DateTo, "", new { @class = "text-danger help-block" })
            </div>
          </div>
        </div>
        <div class="form-actions">
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <button type="submit" class="btn btn-primary">إضافة</button>
              <button type="button" class="btn btn-danger" data-dismiss="modal">إلغاء</button>
              <a href="/HumanResource/EmpEmploymentType/Add" class="btn btn-success pull-right" data-ajax="true" data-ajax-method="Get" data-ajax-mode="replace-with" data-ajax-update="#add-emp-employment-type">نوع توظيفي جديد</a>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</div>

<input type="hidden" id="resEmploymentTypeID" />
<input type="hidden" id="resEmployeeNo" />


<script type="text/javascript">


  jQuery(document).ready(function () {



    var ddlEmp = $("#EmployeeID");
    var ddl = $("#EmploymentTypeID");



    ddlEmp.change(function (e) {
      $.ajax({
        type: "POST",
        url: "EmpEmploymentType/EmpEmploymentTypeGet?id=" + ddlEmp.val(),
        contentType: "application/json; charset=utf-8",
        data: '{}',
        dataType: "json",
        success: function (response) {
          //$("#EmployeeNo").val(response.empnum);
          console.log(response);

          ddl.val(response.EmploymentTypeID);
          $("#EmployeeNo").val(response.EmployeeNo);
        },
        error: function (xhr, status, error) {
          console.log("حدث خطأ ما !");
        }
      });
    });
      
      ddl.change(function (e) {

          console.log("EmploymentTypeID change");
      $.ajax({
        type: "POST",
        url: "EmpEmploymentType/UpdateEmpNumber?EmployeeID=" + ddlEmp.val()+"&EmploymentTypeID=" + ddl.val(),
        contentType: "application/json; charset=utf-8",
        data: '{}',
        dataType: "json",
        success: function (response) {



            $("#EmployeeNo").val(response.EmployeeNo);

        },
        error: function (xhr, status, error) {
          $("#EmployeeNo").val("حدث خطأ ما !");

        }
      });
    });


  });





</script>