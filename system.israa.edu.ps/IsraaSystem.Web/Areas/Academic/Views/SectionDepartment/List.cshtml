@using System.Data
@model IsraaSystem.Core.Classic.Academic.SectionDepartment.SectionDepartment
@{
  Layout = null;
}

<div id="section-department" class="modal-content">
  @if (TempData["toast-msg"] != null)
  {
    int status = Convert.ToInt32(TempData["toast-msg"].ToString().Split(';')[0]);
    String msg = TempData["toast-msg"].ToString().Split(';')[1];
    <script type="text/javascript">
            showToast("@msg", "@((status > 0) ? "success" : "error")");
    </script>
  }
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">طلاب الشعبة</h4>
  </div>
  <div class="modal-body modal-form">
    <div class="portlet-body form">
      <div class="form-horizontal">
        <div class="form-body">
          <div class="form-group">
            <label class="col-md-2 control-label">المساق</label>
            <div class="col-md-5">
              @Html.TextBoxFor(model => model.CourseName, new { @class = "form-control", @readonly = "readonly" })
            </div>
            <label class="col-md-1 control-label">الشعبة</label>
            <div class="col-md-3">
              @Html.TextBoxFor(model => model.SectionNum, new { @class = "form-control", @readonly = "readonly" })
            </div>
          </div>
        </div>
      </div>
      @{
        AjaxOptions opt = new AjaxOptions
        {
          InsertionMode = InsertionMode.ReplaceWith,
          HttpMethod = "POST",
          UpdateTargetId = "section-department"
        };
      }
      @using (Ajax.BeginForm("List", null, opt, new { @class = "form-horizontal" }))
      {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(model => model.SectionID)
        <div class="form-body">
          <div class="form-group">
            <label class="col-md-2 control-label">القسم</label>
            <div class="col-md-5">
              @Html.DropDownListFor(model => model.DepartmentID, new SelectList(Model.Departments, "Value", "Text"), "إختر القسم", new { @class = "form-control select2" })
              @Html.ValidationMessageFor(model => model.DepartmentID, "", new { @class = "text-danger help-block" })
            </div>
            <label class="col-md-1 control-label">المستوى</label>
            <div class="col-md-2">
              @Html.DropDownListFor(model => model.StudyLevelID, new SelectList(Model.StudyLevels, "Value", "Text"), "إختر", new { @class = "form-control" })
              @Html.ValidationMessageFor(model => model.StudyLevelID, "", new { @class = "text-danger help-block" })
            </div>
            <div class="col-md-1">
              <button type="submit" class="btn btn-primary">إضافة</button>
            </div>
          </div>
        </div>
      }
      <div class="row">
        <div class="col-md-offset-1 col-md-10">
          @if (Model.SectionDepartments != null && Model.SectionDepartments.Rows.Count > 0)
          {
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th class="wp3">#</th>
                  <th class="wp50 text-center">القسم</th>
                  <th class="wp15 text-center">المستوى</th>
                  <th class="wp15 text-center">عدد الطلاب</th>
                  <th class="wp10 text-center"></th>
                </tr>
              </thead>
              <tbody>
                @foreach (DataRow row in Model.SectionDepartments.Rows)
                {
                  string cls = "";
                  if (row["SectionGender"].ToString() != row["GenderID"].ToString())
                  {
                    cls = "warning";
                  }
                  <tr class="@cls">
                    <td>@row["RowNo"]</td>
                    <td class="text-center">@row["CollegeName"] - @row["DepartmentName"]</td>
                    <td class="text-center">@row["StudyLevelName"]</td>
                    <td class="text-center">@row["StudentCount"]</td>
                    <td class="text-center">




                        <a href="/Academic/SectionDepartment/Activate?sectionId=@Model.SectionID&departmentId=@row["DepartmentID"]&studyLevelId=@row["StudyLevelID"]&GenderID=@row["GenderID"]" class="btn btn-sm @((row["IsExist"].ToString() == "1")? "btn-danger": "btn-primary")" data-ajax="true" data-ajax-method="Post" data-ajax-mode="replace-with" data-ajax-update="#section-department"><span class="fa fa-@((row["IsExist"].ToString() == "1")? "ban": "check")"></span></a>
                        @if (row["SectionGender"].ToString() == row["GenderID"].ToString() && row["GenderID"].ToString() !="3")
                        {
                          <a href="/Academic/SectionDepartment/SectionDepartmentSpecialAdd?sectionId=@Model.SectionID&SectionDepartmentID=@row["ID"]" class="btn btn-sm btn-warning" data-ajax="true" data-ajax-method="Post" data-ajax-mode="replace-with" data-ajax-update="#section-department"><span class="fa fa-plus"></span></a>

                        }

                    </td>
                  </tr>
                }
              </tbody>
            </table>
          }
          else
          {
            <div class="alert alert-info alert-dismissible text-center" role="alert">
              <span>لا يوجد بيانات لعرضها</span>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>