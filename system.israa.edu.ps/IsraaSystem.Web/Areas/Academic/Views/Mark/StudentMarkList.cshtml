@using System.Activities.Expressions
@using System.Data
@using IsraaSystem.Application.Common.Enums
@using IsraaSystem.Application.Common.Enums.Academic
@using IsraaSystem.Web.Common
@model IsraaSystem.Web.Areas.Academic.Models.Mark.MarkIndexVm

@{
  /**/

  /**/

  Layout = null;
}
<div id="refresh-list"></div>


<div id="data-list">

  @Html.Partial("_IsraaValidationSammary")
  @Html.Partial("_IsraaInlineAlert", Model)
  @Html.HiddenFor(model => model.SortOrder)
  @Html.HiddenFor(model => model.SortKey)





  @if (Model.Result != null && Model.Result.Any())
  {

    @*if (Model.SectionsMarksDto.IsMidAcademicAllAccreditation)
      {
        <div class="note note-success">

          <p> تم اعتماد جميع العلامات</p>
        </div>
      }
      else if (!Model.SectionsMarksDto.IsMidAcademicAllAccreditation)
      {
        <div class="note note-warning">

          <p> لم يتم اعتماد جميع العلامات</p>
        </div>

      }*@

    <div class="note note-info">
      <div class="row">
        <div class="col-md-6">
          <h4 class="block font-green bold uppercase">
            @Model.SectionsMarksDto.CourseName
          </h4>
          <p>
            <ul class="list-inline">
              <li> <strong>شعبة</strong>&nbsp:&nbsp; @Model.SectionsMarksDto.SectionNum </li>
              <li> <strong>المحاضر</strong>&nbsp:&nbsp; @Model.SectionsMarksDto.EmployeeName </li>

            </ul>
          </p>
        </div>
        <div class=" col-md-6">
          <div class="col-md-4">


            @if (Model.SectionsMarksDto.IsFinalDeanAllAccreditation && !Model.SectionsMarksDto.IsFinalAcademicAllAccreditation && ThisUser.HasAction("Academic.SectionMark.AcademicSectionAccredit"))
            {

              @Ajax.ActionLink(
                "اعتماد كنائب",
                "AcademicSectionAccredit",
                "SectionMark",
                new { id = Model.SectionID, accreditationTypeEnum = AccreditationTypeEnum.Academic, examTypeEnum = ExamTypeEnum.Final },
                new AjaxOptions
                {
                  UpdateTargetId = "refresh-list",
                  InsertionMode = InsertionMode.Replace,
                  HttpMethod = "POST",
                  OnSuccess = JsHelper.ShowToast(ToastTypeEnum.success,"تمت العملية بنجاح"),
                  OnFailure = JsHelper.ShowToast(ToastTypeEnum.error, "حدث خطأ ما!"),
                  OnComplete = JsHelper.SubmitForm("israa-form"),


                }
                , new { @class = "btn btn-block green-jungle btn-success" })
            }
            else
            {
            <a class="btn btn-block green-jungle btn-success disabled">اعتماد كنائب</a>

            }


            @if ((Model.SectionsMarksDto.FinalDeanAccreditationCount > 0 || Model.SectionsMarksDto.FinalAcademicAccreditationCount > 0) && ThisUser.HasAction("Academic.SectionMark.AcademicReturnAccredit"))
            {

              @Ajax.ActionLink(
                "ارجاع كنائب",
                "AcademicReturnAccredit",
                "SectionMark",
                new {id = Model.SectionID  , examTypeEnum=ExamTypeEnum.Final},
                new AjaxOptions
                {
                  UpdateTargetId = "refresh-list",
                  InsertionMode = InsertionMode.Replace,
                  HttpMethod = "POST",
                  OnSuccess = JsHelper.ShowToast(ToastTypeEnum.success,"تمت العملية بنجاح"),
                  OnFailure = JsHelper.ShowToast(ToastTypeEnum.error, "حدث خطأ ما!"),
                  OnComplete = JsHelper.SubmitForm("israa-form"),
                  Confirm = "هل أنت متأكد من أنك تود ارجاع علامات الشعبة ؟"


                }
                , new
                {
                  @class = "btn btn-block btn-danger "
                })


            }
            else
            {
            <a class="btn btn-block btn-danger">ارجاع كنائب</a>

            }

          </div>
          <div class="col-md-4 ">

            @if (Model.SectionsMarksDto.FinalAcademicAccreditationCount == 0 && Model.SectionsMarksDto.IsFinalTeacherAllAccreditation && !Model.SectionsMarksDto.IsFinalDeanAllAccreditation)
            {

              @Ajax.ActionLink(
                "اعتماد كعميد",
                "DeanSectionAccredit",
                "SectionMark",
                new { id = @Model.SectionsMarksDto.ID, accreditationTypeEnum = AccreditationTypeEnum.Dean, examTypeEnum = ExamTypeEnum.Final },
                new AjaxOptions
                {
                  UpdateTargetId = "refresh-list",
                  InsertionMode = InsertionMode.Replace,
                  HttpMethod = "POST",
                  OnSuccess = JsHelper.ShowToast(ToastTypeEnum.success,"تمت العملية بنجاح"),
                  OnFailure = JsHelper.ShowToast(ToastTypeEnum.error, "حدث خطأ ما!"),
                  OnComplete = JsHelper.SubmitForm("israa-form")


                }
                , new { @class = "btn btn-block green-jungle btn-success" })

            }
            else
            {
            <a class="btn btn-block green-jungle btn-success disabled">اعتماد كعميد</a>
            }


            @if (Model.SectionsMarksDto.FinalAcademicAccreditationCount == 0 && Model.SectionsMarksDto.FinalTeacherAccreditationCount > 0)

            {

              @Ajax.ActionLink(
                "ارجاع كعميد",
                "DeanReturnAccredit",
                "SectionMark",
                new {id = Model.SectionID  , examTypeEnum=ExamTypeEnum.Final},
                new AjaxOptions
                {
                  UpdateTargetId = "refresh-list",
                  InsertionMode = InsertionMode.Replace,
                  HttpMethod = "POST",
                  OnSuccess = JsHelper.ShowToast(ToastTypeEnum.success,"تمت العملية بنجاح"),
                  OnFailure = JsHelper.ShowToast(ToastTypeEnum.error, "حدث خطأ ما!"),
                  OnComplete = JsHelper.SubmitForm("israa-form"),
                  Confirm = "هل أنت متأكد من أنك تود ارجاع علامات الشعبة ؟"


                }
                , new
                {
                  @class = "btn btn-block btn-danger"
                })
            }else
            {
            <a class="btn btn-block btn-danger disabled">ارجاع كعميد</a>

            }
          </div>
          <div class="col-md-4">
            <a href="/Academic/Mark/SectionStudentsMarks?sectionID=@Model.SectionID.ToString()" class="btn btn-default btn-block">
              <i class="fa fa-download"></i>
              كشف علامات الطلاب
            </a>
            <a href="/Academic/Mark/SectionStudentsMidtermMarks?sectionID=@Model.SectionID.ToString()" class="btn btn-default btn-block">
              <i class="fa fa-download"></i>
              كشف العلامات النصفية
            </a>
          </div>
        </div>
      </div>
    </div>

    <hr />
    <div class="table-scrollable">
      <table class="table table-striped table-bordered table-hover ">
        <thead>
          <tr>

            <th>#</th>
            <th>
              <span>رقم الطالب </span>
            </th>
            <th class=" sortable" sortKey="StudentName">
              <a>اسم الطالب <i class="fa fa-fw fa-sort pull-right"></i></a>
            </th>
            <th class=" sortable" sortKey="WorkMark">
              <a> اعمال الفصل <i class="fa fa-fw fa-sort pull-right"></i></a>
            </th>
            <th class=" sortable" sortKey="MidtermMark">
              <a> النصفي <i class="fa fa-fw fa-sort pull-right"></i></a>
            </th>
            <th class=" sortable" sortKey="FinalMark">
              <a> النهائي <i class="fa fa-fw fa-sort pull-right"></i></a>
            </th>
            <th class=" sortable" sortKey="TotalMark">
              <a> العلامة <i class="fa fa-fw fa-sort pull-right"></i></a>
            </th>
            <th>
              اعتماد نصفي
            </th>
            <th>
              اعتماد نهائي
            </th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @if (Model.Result.Any())
          {
            var rowNo = 0;

            foreach (var item in Model.Result)
            {
              rowNo++;
              <tr    >
                <td>@rowNo</td>
                <td class="text-nowrap">@item.StudentNo</td>
                <td class="text-nowrap">@item.StudentName</td>
                <td class="text-nowrap">@item.WorkMark</td>
                <td>
                  @if (item.IsMidtermNoMark)
                  {
                    <span class="text-danger">غياب</span>
                  }
                  else
                  {
                    @item.MidtermMark
                  }
                </td>
                <td class="text-nowrap">
                  @if (item.IsFinalNoMark)
                  {
                    <span class="text-danger">غياب</span>
                  }
                  else
                  {
                    @item.FinalMark
                  }
                </td>
                <td class="text-nowrap">@item.TotalMark</td>

                <td class="text-nowrap">
                  @if (item.midTeacherAccreditation)
                  {
                    <a href="javascript:;" class="btn btn-xs  btn-success  disabled"> محاضر</a>

                  }
                  else
                  {
                    <a href="javascript:;" class="btn btn-xs btn-default disabled "> محاضر</a>
                  }


                  @if (item.midDeanAccreditation)
                  {
                    <a href="javascript:;" class="btn btn-xs btn-success  disabled">عميد</a>

                  }
                  else
                  {
                    <a href="javascript:;" class="btn btn-xs btn-default disabled "> عميد</a>

                  }

                  @if (item.midAcademicAccreditation)
                  {
                    <a href="javascript:;" class="btn btn-xs btn-success  disabled">نائب</a>

                  }
                  else
                  {
                    <a href="javascript:;" class="btn btn-xs btn-default disabled "> نائب</a>

                  }
                </td>


                <td class="text-nowrap">
                  @if (item.finalTeacherAccreditation)
                  {
                    <a href="javascript:;" class="btn btn-xs  btn-success  disabled"> محاضر</a>

                  }
                  else
                  {
                    <a href="javascript:;" class="btn btn-xs btn-default disabled "> محاضر</a>
                  }


                  @if (item.finalDeanAccreditation)
                  {
                    <a href="javascript:;" class="btn btn-xs btn-success  disabled">عميد</a>

                  }
                  else
                  {
                    <a href="javascript:;" class="btn btn-xs btn-default disabled "> عميد</a>

                  }

                  @if (item.finalAcademicAccreditation)
                  {
                    <a href="javascript:;" class="btn btn-xs btn-success  disabled">نائب</a>

                  }
                  else
                  {
                    <a href="javascript:;" class="btn btn-xs btn-default disabled "> نائب</a>

                  }
                </td>


                  <td class="text-nowrap">
                  @*@if (item.midDeanAccreditation && item.midTeacherAccreditation)*@
                  @if (item.finalTeacherAccreditation && !item.finalDeanAccreditation)
                  {

                    <a href="@Url.Action("DeanMarkAccredit", new {stdSectionId = item.StdSectionId, examTypeEnum = ExamTypeEnum.Final})" class="btn btn-xs   green-jungle" data-ajax="true" data-title="اعتماد" data-ajax-method="POST" data-ajax-mode="replace-with" data-ajax-update="#refresh-list">اعتماد كعميد</a>


                  }
                  @if (!item.finalAcademicAccreditation && (item.finalDeanAccreditation || item.finalTeacherAccreditation))
                  {

                    <a href="@Url.Action("DeanMarkReturnAccredit", new {stdSectionId = item.StdSectionId, examTypeEnum = ExamTypeEnum.Final})" class="btn btn-xs btn-danger   confirm" data-title="ارجاع عميد" data-msg="هل أنت متأكد من أنك تود ارجاع علامات الشعبة ؟" data-action="ارجاع" data-ajax-update="#refresh-list">ارجاع كعميد</a>

                  }
                  @if ((!item.finalAcademicAccreditation && item.finalDeanAccreditation && ThisUser.HasAction("Academic.Mark.AcademicMarkAccredit"))|| ThisUser.IsInRole("نائب أكاديمي"))
                  {

                    <a href="@Url.Action("AcademicMarkAccredit", new {stdSectionId = item.StdSectionId, examTypeEnum = ExamTypeEnum.Final})" class="btn btn-xs   green-jungle" data-ajax="true" data-title="اعتماد" data-ajax-method="POST" data-ajax-mode="replace-with" data-ajax-update="#refresh-list">اعتماد كنائب</a>

                  }

                  @if ((item.finalAcademicAccreditation || item.finalDeanAccreditation || item.finalTeacherAccreditation) && ThisUser.HasAction("Academic.Mark.AcademicMarkReturnAccredit"))
                  {
                    <a href="@Url.Action("AcademicMarkReturnAccredit", new {stdSectionId = item.StdSectionId, examTypeEnum = ExamTypeEnum.Final})" class="btn btn-xs btn-danger   confirm" data-title="ارجاع كنائب" data-msg="هل أنت متأكد من أنك تود ارجاع علامات الشعبة ؟" data-action="ارجاع" data-ajax-update="#refresh-list">ارجاع كنائب</a>
                  }
                  @*@if (Convert.ToBoolean(row["DeanAccreditation"]) && !Convert.ToBoolean(row["AcademicAccreditation"]))
                    {
                        <a href="/Academic/Mark/MarkAcademicAccredit/@row["StdSectionID"]" class="btn btn-sm btn-success" data-ajax="true" data-title="اعتماد علامة" data-ajax-method="POST" data-ajax-mode="replace-with" data-ajax-update="#data-list"><i class="fa fa-check"></i>اعتماد نائب أكاديمي</a>
                    }
                    @if (Convert.ToBoolean(row["AcademicAccreditation"]))
                    {
                        <a href="/Academic/Mark/MarkAcademicReturnAccredit/@row["StdSectionID"]" class="btn btn-sm btn-danger confirm" data-title="ارجاع علامة" data-msg="هل أنت متأكد من أنك تود ارجاع علامة الطالب ؟" data-action="ارجاع" data-ajax-update="#data-list"><span class="fa fa-times"></span>ارجاع نائب أكاديمي </a>
                    }*@
                </td>

              </tr>
            }
          }

        </tbody>
      </table>

    </div>
  }
  else
  {
    <div class="alert alert-info alert-dismissible text-center" role="alert">
      <span>لا يوجد بيانات لعرضها</span>
    </div>
  }






</div>




<script type="text/javascript">
  $(document).ready(function () {


    $('.sortable').click(function () {
      $("#SortKey").val($(this).attr("sortKey"));
      $("#SortOrder").val(($("#SortOrder").val() == "True" ? "False" : "True"));
      $(this).closest('form').submit();
    });
  });
</script>



