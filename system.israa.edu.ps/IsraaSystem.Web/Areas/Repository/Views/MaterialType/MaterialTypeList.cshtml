
@{
    ViewBag.Title = "ادارة المخازن - تصنيفات الأصناف";
    ViewBag.Menu = "#menu-material-type-list";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string test = ViewBag.ss;
}

@section PageBreadcrumb{
    <li>
        <a href="/Repository/material">الرئيسية</a>
        <i class="fa fa-circle"></i>
    </li>
    <li>
        <a href="/Repository/MaterialType">تصنيفات الأصناف</a>
        <i class="fa fa-circle"></i>
    </li>
    <li>
        <a>ادارة تصنيفات الأصناف</a>
    </li>
}

@section PagePlugins {
    <link href="~/assets/global/plugins/jstree/dist/themes/default/style.min.css" rel="stylesheet" type="text/css" />
    <script src="~/assets/global/plugins/jstree/dist/jstree.min.js" type="text/javascript"></script>
}

@section PageScripts {
    <script>
        jQuery(document).ready(function () {
            $('#tree_2').jstree({
                plugins: ["wholerow", "checkbox", "types"],
                core: {
                    themes: {
                        responsive: true
                    },
                    multiple: false,
                    data:
                        @Html.Raw(test)
                    },
                checkbox : {
                 deselect_all: true,
                 three_state : false,
                },
                types: {
                    "default": {
                        icon: "fa fa-folder icon-state-warning icon-lg"
                    },
                    file: {
                        icon: "fa fa-file icon-state-warning icon-lg"
                    }
                }
            });


            $('#edit').click(function () {
                var selectedNode = $('#tree_2').jstree(true).get_selected(true)
                if (selectedNode.length === 0) {
                    $('#edit').removeClass('pop-up-md');
                    $('#tt').css({ "border-color": "red", "border-style":"solid" });
                    showToast("يجب تحديد التصنيف للتعديل عليه", "error");
                    $('#edit').attr('href', '#');
                    selectedNode= [];
                }
                else {
                    var id = selectedNode[0].id;
                    $('#edit').addClass('pop-up-md');
                    $('#edit').attr('href', '/Repository/MaterialType/Edit?id=' + id);
                    $('#tt').css({ "border-color": "", "border-style": "" });
                    selectedNode = [];
                }
            });


            $('#add').click(function () {
                var selectedNode = $('#tree_2').jstree(true).get_selected(true);
                $('#tt').css({ "border-color": "", "border-style": "" });
                if (selectedNode.length > 0) {
                    var id = selectedNode[0].id;
                    $('#add').attr('href', '/Repository/MaterialType/Add?id=' + id);
                    selectedNode = [];
                } else {
                    id = null;
                    $('#add').attr('href', '/Repository/MaterialType/Add?id=' + id);
                }
            });

            $('#delete').click(function () {
                var selectedNode = $('#tree_2').jstree(true).get_selected(true);
                if (selectedNode.length === 0) {
                    $('#delete').removeClass('confirm');
                    $('#tt').css({ "border-color": "red", "border-style": "solid" });
                    showToast("يجب تحديد التصنيف لحذفه", "error");
                    $('#delete').attr('href', '#');
                    selectedNode = [];
                }
                else {
                    var id = selectedNode[0].id;
                    $('#delete').addClass('confirm');
                    $('#delete').attr('href', '/Repository/MaterialType/Delete?id=' + id);
                    $('#tt').css({ "border-color": "", "border-style": "" });
                    selectedNode = [];
                }
            });

            $('#refresh').click(function () {
                $.ajax({
                    type: "GET",
                    url: "/Repository/MaterialType/MaterialTypeList2",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        $('#tree_2').jstree(true).settings.core.data = response;
                        $('#tree_2').jstree(true).redraw(true);
                    },
                    error: function (xhr, status, error) {
                        $("#tree_2").html("حدث خطأ ما !");
                    }
                });
            });

        });

    </script>
}

<div class="row">
    <div class="col-md-12">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-social-dribbble font-green"></i>
                    <span class="caption-subject font-green bold uppercase">التصنيفات على شكل شجرة</span>
                </div>
                <div class="actions">
                    <a id="add" href="#" class="btn btn-sm green-sharp pop-up-md">
                        <i class="fa fa-plus"></i>
                        اضافة تصنيف
                    </a>
                    <a id="edit" href="#" class="btn btn-sm grey-salsa pop-up-md">
                        <i class="fa fa-edit"></i>
                        تعديل تصنيف
                    </a>
                    <a id="delete" href="#" class="btn btn-sm red-mint confirm" data-title="حذف تصنيف" data-msg="هل أنت متأكد من أنك تود حذف التصنيف ؟" data-action="حذف" ><i class="fa fa-times"></i>حذف تصنيف </a>
                    <button id="refresh" class="btn btn-sm blue-ebonyclay"><i class="fa fa-refresh"></i>refresh</button>
                </div>
            </div>
            <div class="portlet-body form">
                <div class="form-body">
                    <div class="form-group">
                        <div id="tt">
                            <div id="tree_2" class="tree-demo"> </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>